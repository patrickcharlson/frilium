{% extends '_base.html' %}

{% load static %}

{% block title %}{{ topic.title }}{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item">
        <a class="white-text" href="{% url 'boards:home' %}">
            <i class="fas fa-home fa-fw"></i> Boards</a>
        <i class="fas fa-angle-double-right mx-2 my-1 text-white" aria-hidden="true"></i>
    </li>
    <li class="breadcrumb-item">
        <a class="white-text" href="{% url 'boards:board_topics' topic.board.slug %}">{{ topic.board.name }}</a>
        <i class="fas fa-angle-double-right mx-2 my-1 text-white" aria-hidden="true"></i>
    </li>
    <li class="breadcrumb-item active text-white-50">{{ topic.title }}</li>
{% endblock %}

{% block content %}

    {% for message in messages %}
        <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <strong>{{ message }}</strong>
        </div>
    {% endfor %}

    <div class="row">
        <div class="col-md-6">
            <div class="float-left">
                <div class="mb-4">
                    <a href="{% url 'boards:reply_topic' topic.slug %}" class="btn blue darken-3 btn-md text-white"
                       role="button">Reply <i class="fa-fw fas fa-reply"></i></a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="float-right">
                {% include 'includes/pagination.html' %}
            </div>
        </div>
    </div>

    {% for post in posts %}
        <div class="card card-posts mb-2" id="pid{{ post.id }}">
            {% if forloop.first %}
                <div class="card-header text-white blue darken-3 py-2 px-3">
                    <div class="row">
                        <div class="col-9">
                            <div class="float-left">
                                {{ topic.title }}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="float-right">
                                #{{ forloop.parentloop.counter }}
                            </div>
                        </div>
                    </div>

                </div>
            {% endif %}
            <div class="card-body p-3">
                <div class="row">
                    <div class="col-10 post-box">
                        <div class="row mb-4 controls">
                            <div class="col-6">
                                <div class="float-left">
                                    <strong class="text-muted">
                                        by
                                        <a href="{% url 'users:user_profile' post.created_by.username %}">
                                            {{ post.created_by.username }}</a>
                                        {{ post.created_at|date:'D M d, Y P' }}
                                    </strong>
                                </div>

                            </div>
                            <div class="col-6">
                                <div class="float-right btn-control">
                                    {% include 'includes/confirm_modal.html' %}
                                    {% if post.created_by == user %}
                                        {% if forloop.first %}
                                            <a class=" btn-icon"
                                               href="{% url 'boards:edit_topic' post.topic.slug %}"
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Edit this topic">
                                                <i style="color: green" class="fas fa-pen-fancy"></i>
                                            </a>
                                            <a class="btn-icon"
                                               href="{% url 'boards:reply_topic' post.topic.slug %}"
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Reply all">
                                                <i style="color: #1565c0" class="fas fa-reply-all"></i>
                                            </a>
                                            <a class="btn-icon" href=""
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Quote this post">
                                                <i style="color: lightblue" class="fas fa-quote-right"></i>
                                            </a>
                                            <a class="btn-icon" href=""
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Report this post">
                                                <i style="color: orange" class="fas fa-exclamation-triangle"></i>
                                            </a>
                                        {% else %}

                                            <a class=" btn-icon" href="{% url 'boards:edit_post' post.slug %}"
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Edit this post">
                                                <i style="color: green" class="fas fa-pen-fancy"></i>
                                            </a>

                                            <form class="form-inline" action="{% url 'boards:delete_post' post.slug %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <span data-toggle="modal" data-target="#exampleModal">
                                                    <a class="btn-icon"
                                                       data-post-id="{{ post.id }}" data-toggle="tooltip"
                                                       data-placement="top"
                                                       title="Delete this post">
                                                        <i style="color: orangered" class="fas fa-trash-alt"></i>
                                                    </a>
                                                </span>
                                            </form>


                                            <a class="btn-icon"
                                               href="{% url 'boards:reply_topic' post.topic.slug %}"
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Reply all">
                                                <i style="color: #1565c0" class="fas fa-reply-all"></i>
                                            </a>

                                            <a class="btn-icon" href=""
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Quote this post">
                                                <i style="color: lightblue" class="fas fa-quote-right"></i>
                                            </a>

                                            <a class="btn-icon" href=""
                                               data-post-id="{{ post.id }}" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Report this post">
                                                <i style="color: orange" class="fas fa-exclamation-triangle"></i>
                                            </a>
                                        {% endif %}
                                    {% else %}
                                        <a class="btn-icon" href="{% url 'boards:reply_topic' post.topic.slug %}"
                                           data-post-id="{{ post.id }}" data-toggle="tooltip" data-placement="top"
                                           title="Reply all">
                                            <i style="color: #1565c0" class="fas fa-reply-all"></i>
                                        </a>
                                        <a class="btn-icon" href=""
                                           data-post-id="{{ post.id }}" data-toggle="tooltip" data-placement="top"
                                           title="Quote this post">
                                            <i style="color: lightblue" class="fas fa-quote-right"></i>
                                        </a>
                                        <a class="btn-icon" href=""
                                           data-post-id="{{ post.id }}" data-toggle="tooltip" data-placement="top"
                                           title="Report this post">
                                            <i style="color: orange" class="fas fa-exclamation-triangle"></i>
                                        </a>
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                        {{ post.get_message_as_markdown }}
                    </div>
                    <div class="col-2">
                        <div class="d-flex justify-content-center">
                            <img src="{% static 'img/avatar-5.png' %}" alt="{{ post.created_by.username }}"
                                 class="">
                        </div>
                        <small>Posts: {{ post.created_by.posts.count }}</small>
                    </div>
                </div>
            </div>

            <div class="card-footer bg-light">
                #{{ forloop.counter }}
            </div>
        </div>
    {% endfor %}

    <div class="row">
        <div class="col-md-6">
            <div class="float-left">
                <div class="my-4">
                    <a href="{% url 'boards:reply_topic' topic.slug %}" class="btn blue darken-3 btn-md text-white"
                       role="button">Reply <i class="fa-fw fas fa-reply"></i></a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="float-right">
                <div class="my-4">
                    {% include 'includes/pagination.html' %}
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascript %}
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 4000);
    </script>

{% endblock %}